function handleFiles(a,b){var c=a[0],d=new FileReader,e=b.getContext("2d");d.onload=function(){var a=new Image;a.onload=function(){this.width/this.height;b.width=this.width,b.height=this.height,e.drawImage(this,0,0,this.width,this.height,0,0,b.width,b.height),getValues(),analyze(),printValues()},a.src=d.result},d.readAsDataURL(c)}function getValues(){function a(a){for(var b=0,c=a.length,d=0;c>d;d+=4)b+=a[d],b+=a[d+1],b+=a[d+2];return b}function b(a){return context.getImageData(a[0],a[1],charw,charh).data}cw=canvas.width,ch=canvas.height,gridWidth=Math.floor(cw/charw),gridHeight=Math.floor(ch/charh),valueArray=[];for(var c=0;gridHeight>c;c++){for(var d=[],e=0;gridWidth>e;e++){var f=[e*charw,c*charh];d.push(a(b(f)))}valueArray.push(d)}}function analyze(){for(var a=0,b=valueArray.length;b>a;a++)for(var c=0,d=valueArray[0].length;d>c;c++)try{var e=valueArray[a][c];e>max?max=e:min>e&&(min=e)}catch(f){console.log(a,c,f)}range=max-min,step=(range-min)/chars.length}function printValues(){var a="";$("output pre").text(a);for(var b=0;gridHeight>b;b++){for(var c=0;gridWidth>c;c++)try{var d=Math.floor(valueArray[b][c]/step),e="x";d>=chars.length?d=chars.length-1:0>d&&(d=0),e=chars[d],void 0===e&&console.log(valueArray[b][c],valueArray[b][c]/step),a+=e}catch(f){console.log(f)}a+="\n"}$("output pre").text(a)}function putRectangle(a,b,c){a.putImageData(b,c[0],c[1])}function paintGrid(){for(var a=0;gridHeight>a;a++)for(var b=0;gridWidth>b;b++)context.strokeStyle="rgb(20, 220,100)",context.strokeRect(b*charw,a*charh,charw,charh)}var DropHandler={$dropzone:null,$dropMessage:null,$dropBox:null,dropped:!1,init:function(){this.$dropzone=$("html"),this.$dropMessage=$(".dropMessage"),this.$dropBox=$(".dropBox"),this.$dropzone.on("dragenter",this.dragenter.bind(this)),this.$dropzone.on("dragover",this.dragover.bind(this)),this.$dropzone.on("drop",this.drop.bind(this)),this.$dropzone.on("dragleave",this.dragleave.bind(this))},dragenter:function(a){a.stopPropagation(),a.preventDefault()},dragover:function(a){a.stopPropagation(),a.preventDefault(),this.$dropBox.show(),$("output, canvas").css({opacity:.1})},dragleave:function(a){a.stopPropagation(),a.preventDefault(),this.$dropBox.hide(),$("output, canvas").css({opacity:1})},drop:function(a){a.stopPropagation(),a.preventDefault();var b=a.originalEvent.dataTransfer,c=b.files;this.dropped=!0,this.ondrop(c),this.$dropBox.hide(),$("output, canvas").css({opacity:1})},ondrop:function(a){handleFiles(a,document.getElementsByTagName("canvas")[0])}};DropHandler.init();var canvas=document.getElementsByTagName("canvas")[0],context=canvas.getContext("2d"),cw=null,ch=null,charw=7,charh=13,gridWidth=null,gridHeight=null,valueArray=[],min=1/0,max=0,sum=0,range=null,step=null,chars=" .-:*+=%#@".split("").reverse().join("");$("header input.preview").on("click",function(){$(this).is(":checked")?$("canvas").show(300):$("canvas").hide(200)});