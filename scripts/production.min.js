function handleFiles(a){var b=a[0];reader=new FileReader,reader.onload=function(){var a=new Image;a.onload=function(){context.drawImage(this,0,0,this.width,this.height,0,0,canvas.width,canvas.height),getValues(),analyze(),printValues()},a.src=reader.result},reader.readAsDataURL(b)}function sum_4(a){for(var b=0,c=a.length,d=0;c>d;d+=4)b+=a[d],b+=a[d+1],b+=a[d+2];return b}function analyze(){for(var a=0,b=valueArray.length;b>a;a++)for(var c=0,d=valueArray[0].length;d>c;c++)try{var e=valueArray[a][c];e>max?max=e:min>e&&(min=e)}catch(f){console.log(a,c,f)}range=max-min,step=(range-min)/chars.length}function getRectangle(a){return context.getImageData(a[0],a[1],charw,charh).data}function putRectangle(a,b,c){a.putImageData(b,c[0],c[1])}function getValues(){valueArray=[];for(var a=0;gridHeight>a;a++){for(var b=[],c=0;gridWidth>c;c++){var d=[c*charw,a*charh];b.push(sum_4(getRectangle(d)))}valueArray.push(b)}}function printValues(){var a="";document.getElementById("out").innerHTML=a;for(var b=0;gridHeight>b;b++){for(var c=0;gridWidth>c;c++)try{var d=Math.floor(valueArray[b][c]/step),e="x";d>=chars.length?d=chars.length-1:0>d&&(d=0),e=chars[d],void 0===e&&console.log(valueArray[b][c],valueArray[b][c]/step),a+=e}catch(f){console.log(f)}a+="<br>"}document.getElementById("out").innerHTML=a}function paintGrid(){for(var a=0;gridHeight>a;a++)for(var b=0;gridWidth>b;b++)context.strokeStyle="rgb(20, 220,100)",context.strokeRect(b*charw,a*charh,charw,charh)}var DropHandler={dropzone:null,dropped:!1,init:function(){var a=this;this.dropzone=document.getElementById("dropzone"),this.dropzone.addEventListener("dragenter",function(b){a.dragenter(b)},!1),this.dragover=this.dragover.bind(this),this.dropzone.addEventListener("dragover",this.dragover,!1),function(a){a.dropzone.addEventListener("drop",function(b){a.drop(b)},!1)}(this),function(a){a.dropzone.addEventListener("dragleave",function(b){a.dragleave(b)},!1)}(this)},dragenter:function(a){a.stopPropagation(),a.preventDefault(),this.dropzone.style.opacity=.5},dragover:function(a){a.stopPropagation(),a.preventDefault(),this.dropzone.style.opacity=.5},dragleave:function(a){a.stopPropagation(),a.preventDefault(),this.dropzone.style.opacity=this.dropped?0:1},drop:function(a){a.stopPropagation(),a.preventDefault();var b=a.dataTransfer,c=b.files;this.dropped=!0,this.dropzone.style.opacity=0,this.ondrop(c)},ondrop:function(a){handleFiles(a)}},canvas=document.getElementsByTagName("canvas")[0],context=canvas.getContext("2d"),reader;DropHandler.init();var cw=canvas.width,ch=canvas.height,charw=3,charh=5,gridWidth=cw/charw,gridHeight=ch/charh,valueArray=[],min=1/0,max=0,sum=0,range=null,step=null,chars=" .-:*+=%#@".split("").reverse().join("");$("header input.preview").on("click",function(){$(this).is(":checked")?$("canvas").show():$("canvas").hide()});