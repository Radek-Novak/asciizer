function Asciizer(a,b){function c(){function a(a){for(var b=0,c=a.length,d=0;c>d;d+=4)b+=a[d],b+=a[d+1],b+=a[d+2];return b}function c(a){return g.getImageData(a[0],a[1],r,s).data}l=[];for(var d=0;k>d;d++){for(var e=[],f=0;b>f;f++){var h=[f*r,d*s];try{e.push(a(c(h)))}catch(i){console.log(i,h)}}l.push(e)}}function d(){for(var a=0,b=l.length;b>a;a++)for(var c=0,d=l[0].length;d>c;c++)try{var e=l[a][c];e>n?n=e:m>e&&(m=e)}catch(f){console.log(a,c,f)}o=n-m,p=(o-m)/q.length}function e(){var a="";$("output pre").text(a);for(var c=0;k>c;c++){for(var d=0;b>d;d++)try{var e=Math.floor(l[c][d]/p),f="x";e>=q.length?e=q.length-1:0>e&&(e=0),f=q[e],a+=f}catch(g){console.log(g)}a+="\n"}$("output pre").text(a)}var f=$("#atelier")[0],g=f.getContext("2d"),h=7/13,i=a,j=i.width/i.height,k=Math.floor(h*(b/j)),l=[],m=1/0,n=0,o=null,p=null,q=" .-:*+=%#@".split("").reverse().join("");f.width=i.width,f.height=i.height;var r=Math.floor(f.width/b),s=Math.floor(f.height/k);window.val=[r,s,b,k,f],g.drawImage(i,0,0,i.width,i.height,0,0,f.width,f.height),c(),d(),e()}function handleFiles(a){var b=a[0],c=new FileReader;c.onload=function(){var a=new Image;a.onload=function(){current=new Asciizer(this,getGridWidth())},a.src=c.result,a.alt="current picture",$("#original-image").empty().append(a)},c.readAsDataURL(b)}function getGridWidth(){return $("#pic-w").val()}var current,DropHandler={$dropzone:null,$dropMessage:null,$dropBox:null,dropped:!1,init:function(){this.$dropzone=$("html"),this.$dropMessage=$(".dropMessage"),this.$dropBox=$(".dropBox"),this.$dropzone.on("dragenter",this.dragenter.bind(this)),this.$dropzone.on("dragover",this.dragover.bind(this)),this.$dropzone.on("drop",this.drop.bind(this)),this.$dropzone.on("dragleave",this.dragleave.bind(this))},dragenter:function(a){a.stopPropagation(),a.preventDefault()},dragover:function(a){a.stopPropagation(),a.preventDefault(),this.$dropBox.show(),$(".pagewrap").css({opacity:0})},dragleave:function(a){a.stopPropagation(),a.preventDefault(),this.$dropBox.hide(),$(".pagewrap").css({opacity:1})},drop:function(a){a.stopPropagation(),a.preventDefault();var b=a.originalEvent.dataTransfer,c=b.files;this.dropped=!0,this.ondrop(c),this.$dropBox.hide(),$(".pagewrap").css({opacity:1})},ondrop:function(a){handleFiles(a)}};DropHandler.init(),$(".sidebar input.preview").on("click",function(){var a=$("#original-image"),b=$('[for="preview"]');$(this).is(":checked")?(a.show(300),b.text("hide original pic")):(a.hide(200),b.text("show original pic"))});