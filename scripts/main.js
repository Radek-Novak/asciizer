function Asciizer(a,b){function c(){function a(a){for(var b=0,c=a.length,d=0;c>d;d+=4)b+=a[d],b+=a[d+1],b+=a[d+2];return b}function c(a){return g.getImageData(a[0],a[1],r,s).data}l=[];for(var d=0;k>d;d++){for(var e=[],f=0;b>f;f++){var h=[f*r,d*s];try{e.push(a(c(h)))}catch(i){console.log(i,h)}}l.push(e)}}function d(){for(var a=0,b=l.length;b>a;a++)for(var c=0,d=l[0].length;d>c;c++)try{var e=l[a][c];e>n?n=e:m>e&&(m=e)}catch(f){console.log(a,c,f)}p=n-m,q=(p-m)/t.length}function e(){var a="";$("pre").text(a);for(var c=0;k>c;c++){for(var d=0;b>d;d++)try{var e=Math.floor(l[c][d]/q),f="x";e>=t.length?e=t.length-1:0>e&&(e=0),f=t[e],a+=f}catch(g){console.log(g)}a+="\n"}$("pre").text(a)}var f=$("#atelier")[0],g=f.getContext("2d"),h=7/13,i=a,j=i.width/i.height,k=null,l=[],m=1/0,n=0,o=0,p=null,q=null,r=null,s=null,t=" .-:*+=%#@".split("").reverse().join("");f.width=i.width,f.height=i.height,this.setGridDimensions=function(a){b=a,k=Math.floor(h*(b/j)),r=Math.floor(f.width/b),s=Math.floor(f.height/k)},this.calculate=function(a){a=a||b,this.setGridDimensions(a),g.drawImage(i,0,0,i.width,i.height,0,0,f.width,f.height),c(),d(),e(),m=1/0,n=0,o=0,p=null,q=null,l=[]},this.setGridDimensions(b),this.calculate(),window.val=[r,s,b,k,f]}function handleFiles(a){var b=a[0],c=new FileReader;c.onload=function(){var a=new Image;a.onload=function(){last=new Asciizer(this,getGridWidth())},a.src=c.result,a.alt="current picture",$("#original-image").empty().append(a)},c.readAsDataURL(b)}function getGridWidth(){return $("#pic-w").val()}var DropHandler={$dropzone:null,$dropMessage:null,$dropBox:null,dropped:!1,init:function(){this.$dropzone=$(".drawingSpace"),this.$dropzone.on("dragenter",this.dragenter.bind(this)),this.$dropzone.on("dragover",this.dragover.bind(this)),this.$dropzone.on("drop",this.drop.bind(this)),this.$dropzone.on("dragleave",this.dragleave.bind(this))},dragenter:function(a){a.stopPropagation(),a.preventDefault()},dragover:function(a){a.stopPropagation(),a.preventDefault(),this.$dropzone.css({opacity:.1}),console.log(this)},dragleave:function(a){a.stopPropagation(),a.preventDefault(),this.$dropzone.css({opacity:1})},drop:function(a){var b=a.originalEvent.dataTransfer,c=b.files;a.stopPropagation(),a.preventDefault(),this.dropped=!0,this.ondrop(c),this.$dropzone.css({opacity:1})},ondrop:function(a){handleFiles(a)}};DropHandler.init();var last,char_size={w:8,h:16};$(".menu input.preview").on("click",function(){var a=$("#original-image"),b=$('[for="preview"]');$(this).is(":checked")?(a.show(300),b.text("hide original pic")):(a.hide(200),b.text("show original pic"))}),$(".recalc").click(function(){last.calculate(getGridWidth())}),$(".draggable").draggable({grid:[char_size.w,char_size.h],containment:"parent",cancel:".inner-box",stack:".draggable"}),$(".resizable").resizable({grid:[char_size.w,char_size.h]});