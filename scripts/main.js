function Asciizer(a,b,c){function d(){function a(a){for(var b=0,c=a.length,d=0;c>d;d+=4)b+=a[d],b+=a[d+1],b+=a[d+2];return b}function c(a){return g.getImageData(a[0],a[1],j,k).data}l=[];for(var d=0;i>d;d++){for(var e=[],f=0;b>f;f++){var h=[f*j,d*k];try{e.push(a(c(h)))}catch(m){console.log(m,h)}}l.push(e)}}function e(){for(var a=0,b=l.length;b>a;a++)for(var c=0,d=l[0].length;d>c;c++)try{var e=l[a][c];e>n?n=e:m>e&&(m=e)}catch(f){console.log(a,c,f)}o=n-m,p=(o-m)/q.length}function f(){var a="";$("output pre").text(a);for(var c=0;i>c;c++){for(var d=0;b>d;d++)try{var e=Math.floor(l[c][d]/p),f="x";e>=q.length?e=q.length-1:0>e&&(e=0),f=q[e],a+=f}catch(g){console.log(g)}a+="\n"}$("output pre").text(a)}var g=a.getContext("2d"),h=7/13,i=Math.floor(h*(b/c)),j=Math.floor(a.width/b),k=Math.floor(a.height/i),l=[],m=1/0,n=0,o=null,p=null,q=" .-:*+=%#@".split("").reverse().join("");window.val=[j,k,b,i,a],d(),e(),f()}function handleFiles(a,b){var c=a[0],d=new FileReader,e=b.getContext("2d");d.onload=function(){var a=new Image;a.onload=function(){var a=this.width/this.height;b.width=this.width,b.height=this.height,e.drawImage(this,0,0,this.width,this.height,0,0,b.width,b.height),current=new Asciizer(b,getGridWidth(),a)},a.src=d.result,a.alt="current picture",$("#original-image").empty().append(a)},d.readAsDataURL(c)}function getGridWidth(){return $("#pic-w").val()}var current,DropHandler={$dropzone:null,$dropMessage:null,$dropBox:null,dropped:!1,init:function(){this.$dropzone=$("html"),this.$dropMessage=$(".dropMessage"),this.$dropBox=$(".dropBox"),this.$dropzone.on("dragenter",this.dragenter.bind(this)),this.$dropzone.on("dragover",this.dragover.bind(this)),this.$dropzone.on("drop",this.drop.bind(this)),this.$dropzone.on("dragleave",this.dragleave.bind(this))},dragenter:function(a){a.stopPropagation(),a.preventDefault()},dragover:function(a){a.stopPropagation(),a.preventDefault(),this.$dropBox.show(),$(".pagewrap").css({opacity:0})},dragleave:function(a){a.stopPropagation(),a.preventDefault(),this.$dropBox.hide(),$(".pagewrap").css({opacity:1})},drop:function(a){a.stopPropagation(),a.preventDefault();var b=a.originalEvent.dataTransfer,c=b.files;this.dropped=!0,this.ondrop(c),this.$dropBox.hide(),$(".pagewrap").css({opacity:1})},ondrop:function(a){handleFiles(a,document.getElementsByTagName("canvas")[0])}};DropHandler.init(),$(".sidebar input.preview").on("click",function(){var a=$("#original-image"),b=$('[for="preview"]');$(this).is(":checked")?(a.show(300),b.text("hide original pic")):(a.hide(200),b.text("show original pic"))});